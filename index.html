<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharmaChain ‚Äî Anti-Counterfeit Supply Tracker</title>
    <!-- Google Fonts (declared here, styled in CSS) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Bebas+Neue&family=Barlow:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- ========== HEADER ========== -->
    <header id="site-header">
        <div class="header-inner">
            <div class="logo-block">
                <div class="logo-icon">‚¨°</div>
                <div class="logo-text">
                    <span class="logo-main">PHARMACHAIN</span>
                    <span class="logo-sub">ANTI-COUNTERFEIT SUPPLY TRACKER</span>
                </div>
            </div>
            <nav id="main-nav">
                <button class="nav-btn active" data-tab="manufacture">MANUFACTURE</button>
                <button class="nav-btn" data-tab="handover">HANDOVER</button>
                <button class="nav-btn" data-tab="verify">VERIFY</button>
            </nav>
            <div class="chain-status">
                <span class="status-dot" id="chain-dot"></span>
                <span id="chain-label">SEPOLIA TESTNET</span>
            </div>
        </div>
    </header>

    <!-- ========== MAIN CONTENT ========== -->
    <main id="main-content">

        <!-- ---- TICKER / CHAIN FEED ---- -->
        <div id="ticker-bar">
            <span class="ticker-label">CHAIN FEED</span>
            <div class="ticker-track">
                <span class="ticker-item">üîó Block #21,834,001 ‚Äî Confirmed</span>
                <span class="ticker-item">‚úÖ M-001 Verified ‚Äî Batch B-101</span>
                <span class="ticker-item">‚ö†Ô∏è Expiry Check Triggered ‚Äî M-003</span>
                <span class="ticker-item">üè≠ New Manufacture ‚Äî M-004 Registered</span>
            </div>
        </div>

        <!-- ============================================================ -->
        <!-- TAB 1: MANUFACTURE                                           -->
        <!-- ============================================================ -->
        <section id="tab-manufacture" class="tab-panel active">
            
            <div class="panel-header">
                <h1 class="panel-title">REGISTER MEDICINE</h1>
                <p class="panel-desc">Create a new medicine unit on-chain. A QR code linked to this Batch ID will be generated and recorded to the Sepolia blockchain.</p>
            </div>

            <div class="panel-body">

                <!-- Form Card -->
                <div class="card form-card">
                    <div class="card-label">01 ‚Äî INPUT PARAMETERS</div>
                    <form id="manufacture-form">

                        <div class="field-group">
                            <label for="batch-id">BATCH ID</label>
                            <input type="text" id="batch-id" name="batch_id" placeholder="e.g. B-101" required>
                            <span class="field-hint">This becomes the Parent QR identifier for this unit.</span>
                        </div>

                        <div class="field-group">
                            <label for="medicine-name">MEDICINE NAME</label>
                            <input type="text" id="medicine-name" name="medicine_name" placeholder="e.g. Paracetamol 500mg" required>
                        </div>

                        <div class="field-group">
                            <label for="origin-gps">ORIGIN GPS COORDINATES</label>
                            <input type="text" id="origin-gps" name="location" placeholder="e.g. 13.0827,80.2707" required>
                            <span class="field-hint">Latitude, Longitude ‚Äî used for teleportation detection.</span>
                        </div>

                        <button type="submit" class="btn btn-primary" id="manufacture-btn">
                            <span class="btn-text">REGISTER ON-CHAIN</span>
                            <span class="btn-loader hidden">BROADCASTING...</span>
                        </button>

                    </form>
                </div>

                <!-- Result Card (hidden until API responds) -->
                <div class="card result-card hidden" id="manufacture-result">
                    <div class="card-label">02 ‚Äî BLOCKCHAIN RECEIPT</div>

                    <div class="result-row">
                        <span class="result-key">TX HASH</span>
                        <span class="result-val mono" id="res-tx-hash">‚Äî</span>
                    </div>
                    <div class="result-row">
                        <span class="result-key">STATUS</span>
                        <span class="result-val status-badge" id="res-status">‚Äî</span>
                    </div>

                    <!-- QR Code Display -->
                    <div class="qr-block">
                        <div class="qr-label">BATCH QR CODE</div>
                        <img id="res-qr-img" src="" alt="QR Code" class="qr-img">
                        <a id="res-qr-download" href="#" download class="btn btn-ghost">DOWNLOAD QR</a>
                    </div>
                </div>

            </div>
        </section>

        <!-- ============================================================ -->
        <!-- TAB 2: HANDOVER                                              -->
        <!-- ============================================================ -->
        <section id="tab-handover" class="tab-panel hidden">

            <div class="panel-header">
                <h1 class="panel-title">SUPPLY CHAIN HANDOVER</h1>
                <p class="panel-desc">Move a batch through the supply chain. The AI risk engine evaluates each transfer for anomalies before writing to the blockchain.</p>
            </div>

            <div class="panel-body">

                <!-- Form Card -->
                <div class="card form-card">
                    <div class="card-label">01 ‚Äî TRANSFER DETAILS</div>
                    <form id="handover-form">

                        <div class="field-group">
                            <label for="ho-batch-id">BATCH ID</label>
                            <input type="text" id="ho-batch-id" name="batch_id" placeholder="e.g. B-101" required>
                        </div>

                        <div class="field-group">
                            <label for="ho-location">NEW LOCATION (GPS)</label>
                            <input type="text" id="ho-location" name="new_location" placeholder="e.g. 28.6139,77.2090" required>
                        </div>

                        <div class="field-group">
                            <label for="ho-role">TRANSFER TO</label>
                            <select id="ho-role" name="role_index" required>
                                <option value="" disabled selected>‚Äî SELECT RECIPIENT ROLE ‚Äî</option>
                                <option value="1">DISTRIBUTOR (In Transit)</option>
                                <option value="2">PHARMACY / HOSPITAL (At Retailer)</option>
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary" id="handover-btn">
                            <span class="btn-text">EXECUTE HANDOVER</span>
                            <span class="btn-loader hidden">ANALYZING RISK...</span>
                        </button>

                    </form>
                </div>

                <!-- Risk Result Card -->
                <div class="card result-card hidden" id="handover-result">
                    <div class="card-label">02 ‚Äî AI RISK ANALYSIS & CHAIN RECEIPT</div>

                    <!-- Risk Meter -->
                    <div class="risk-meter-block">
                        <div class="risk-label-row">
                            <span class="result-key">RISK SCORE</span>
                            <span class="risk-value mono" id="res-risk-score">‚Äî</span>
                        </div>
                        <div class="risk-bar-bg">
                            <div class="risk-bar-fill" id="res-risk-bar"></div>
                        </div>
                        <span class="risk-verdict" id="res-risk-verdict">‚Äî</span>
                    </div>

                    <div class="result-row">
                        <span class="result-key">TX HASH</span>
                        <span class="result-val mono" id="res-ho-tx-hash">‚Äî</span>
                    </div>
                    <div class="result-row">
                        <span class="result-key">STATUS</span>
                        <span class="result-val status-badge" id="res-ho-status">‚Äî</span>
                    </div>
                </div>

            </div>
        </section>

        <!-- ============================================================ -->
        <!-- TAB 3: VERIFY                                                -->
        <!-- ============================================================ -->
        <section id="tab-verify" class="tab-panel hidden">

            <div class="panel-header">
                <h1 class="panel-title">AUTHENTICATE MEDICINE</h1>
                <p class="panel-desc">Scan a Medicine ID to verify authenticity against the blockchain. Ghost, Zombie, and Teleportation checks are run automatically.</p>
            </div>

            <div class="panel-body">

                <!-- Form Card -->
                <div class="card form-card">
                    <div class="card-label">01 ‚Äî SCAN / ENTER ID</div>
                    <form id="verify-form">

                        <div class="field-group">
                            <label for="v-medicine-id">MEDICINE ID</label>
                            <input type="text" id="v-medicine-id" name="medicine_id" placeholder="e.g. M-555" required>
                        </div>

                        <div class="field-group">
                            <label for="v-location">SCAN LOCATION (GPS)</label>
                            <input type="text" id="v-location" name="location" placeholder="e.g. 19.0760,72.8777" required>
                        </div>

                        <button type="submit" class="btn btn-primary" id="verify-btn">
                            <span class="btn-text">AUTHENTICATE</span>
                            <span class="btn-loader hidden">QUERYING CHAIN...</span>
                        </button>

                    </form>
                </div>

                <!-- Verification Result Card -->
                <div class="card result-card hidden" id="verify-result">
                    <div class="card-label">02 ‚Äî AUTHENTICATION RESULT</div>

                    <!-- Big AUTHENTIC / FAKE Banner -->
                    <div class="auth-verdict-banner" id="auth-banner">
                        <span class="auth-icon" id="auth-icon">?</span>
                        <span class="auth-text" id="auth-text">PENDING</span>
                    </div>

                    <!-- Blockchain Data Table -->
                    <div class="data-table" id="verify-data-table">
                        <div class="result-row">
                            <span class="result-key">MEDICINE NAME</span>
                            <span class="result-val" id="res-v-name">‚Äî</span>
                        </div>
                        <div class="result-row">
                            <span class="result-key">LAST LOCATION</span>
                            <span class="result-val mono" id="res-v-location">‚Äî</span>
                        </div>
                        <div class="result-row">
                            <span class="result-key">STATUS CODE</span>
                            <span class="result-val mono" id="res-v-status">‚Äî</span>
                        </div>
                    </div>

                    <!-- Journey Graph (image returned by AI engine) -->
                    <div class="journey-block hidden" id="journey-block">
                        <div class="journey-label">SUPPLY CHAIN JOURNEY</div>
                        <img id="journey-graph-img" src="" alt="Journey Graph" class="journey-img">
                    </div>

                    <!-- Movement History Table -->
                    <div class="history-block hidden" id="history-block">
                        <div class="journey-label">MOVEMENT HISTORY</div>
                        <table id="history-table">
                            <thead>
                                <tr>
                                    <th>ROLE</th>
                                    <th>LOCATION</th>
                                    <th>RISK SCORE</th>
                                    <th>TIMESTAMP</th>
                                </tr>
                            </thead>
                            <tbody id="history-tbody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </section>

    </main>

    <!-- ========== FOOTER ========== -->
    <footer id="site-footer">
        <span>PHARMACHAIN v1.0 ‚Äî SEPOLIA TESTNET</span>
        <span>Built on Ethereum ¬∑ FastAPI ¬∑ MongoDB ¬∑ AI Risk Engine</span>
    </footer>

    <!-- Toast Notification (global) -->
    <div id="toast" class="toast hidden">
        <span id="toast-msg">Message here</span>
    </div>

    <script src="app.js"></script>
</body>
</html>